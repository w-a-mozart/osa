<?php

/**
 * @file
 * Drupal Module for The Oakville Suzuki Association
 * - customizes several CiviCRM pages and forms
 * - adds entity for multi-day events (e.g. Group Class)
 */
require_once 'osa.inc';
require_once 'osa.civicrm.inc';
require_once 'osa.commerce.inc';
require_once 'osa.group_class.inc';

/**
 * This hook is called before a CiviCRM page is rendered and invokes the appropriate customization function.
 *
 * @param $page
 *   The page being rendered.
 */
function osa_civicrm_pageRun(&$page) {
  $name = $page->getVar('_name');
  
  if (function_exists("osa_civicrm_page_$name")) {
    call_user_func_array("osa_civicrm_page_$name", array(&$page));
  }
}

/**
 * Implements hook_civicrm_buildForm to route requests to specific form overrides.
 *
 * @param string $formName
 *   The name of the form.
 * @param object $form
 *   Reference to the form object.
 */
function osa_civicrm_buildForm($formName, &$form) {
  if (function_exists("osa_civicrm_buildForm_$formName")) {
    call_user_func_array("osa_civicrm_buildForm_$formName", array(&$form));
  }
  
  // check for the Email Task Forms
  if (substr($formName, -16) == '_Form_Task_Email') {
    osa_civicrm_buildForm_CRM_Contact_Form_Task_EmailCommon($form);
  }
}

/**
 * Implements hook_civicrm_validate to route requests to specific form overrides.
 *
 * @param string $formName
 *   The name of the form.
 * @param object $form
 *   A reference to the form object.
 */
function osa_civicrm_validate($formName, &$fields, &$files, &$form) {
  if (function_exists("osa_civicrm_validate_$formName")) {
    call_user_func_array("osa_civicrm_validate_$formName", array(&$fields, &$files, &$form));
  }
}

/**
 * Implements hook_civicrm_postProcess to route requests to specific form overrides.
 *
 * @param string $formName
 *   The name of the form.
 * @param object $form
 *   A reference to the form object.
 */
function osa_civicrm_postProcess($formName, &$form) {
  if (function_exists("osa_civicrm_postProcess_$formName")) {
    call_user_func_array("osa_civicrm_postProcess_$formName", array(&$form));
  }
}

/**
 * Implements hook_form_alter() to modify forms generated by Drupal modules
 */
function osa_form_alter(&$form, &$form_state, $form_id) {

  if (function_exists("osa_form_alter_$form_id")) {
    call_user_func_array("osa_form_alter_$form_id", array(&$form, &$form_state));
  }
}

/**
 * Implements hook_node_presave() to perform custom processing when Drupal content is saved
 */
function osa_node_presave($node) {
  
  if (function_exists("osa_node_presave_{$node->type}")) {
    call_user_func_array("osa_node_presave_{$node->type}", array(&$node));
  }
}

/**
 * Implements hook_webform_submission_presave() to webform submissions
 */
function osa_webform_submission_presave($node, &$submission) {

  if (function_exists("osa_webform_submission_presave_{$node->nid}")) {
    call_user_func_array("osa_webform_submission_presave_{$node->nid}", array(&$node, &$submission));
  }
}
